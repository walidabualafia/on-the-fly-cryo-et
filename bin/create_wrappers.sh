#!/bin/bash
# Script to create symlinks for all wrapper commands
# This should be run once after cloning the repository
#
# Usage: ./create_wrappers.sh

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WRAPPER="$SCRIPT_DIR/_wrapper.sh"

# Make wrapper executable
chmod +x "$WRAPPER"
chmod +x "$SCRIPT_DIR/setup.sh"

# List of all tools to wrap
TOOLS=(
    # RELION tools
    "relion"
    "relion_align_symmetry"
    "relion_autopick"
    "relion_autopick_mpi"
    "relion_backproject_2d"
    "relion_batchrun"
    "relion_batchrun_mpi"
    "relion_class_ranker"
    "relion_convert_star"
    "relion_convert_to_tiff"
    "relion_convert_to_tiff_mpi"
    "relion_ctf_mask_test"
    "relion_ctf_refine"
    "relion_ctf_refine_mpi"
    "relion_ctf_toolbox"
    "relion_delete_blobs_2d"
    "relion_demodulate"
    "relion_display"
    "relion_estimate_gain"
    "relion_external_reconstruct"
    "relion_filament_selection"
    "relion_find_tiltpairs"
    "relion_flex_analyse"
    "relion_flex_analyse_mpi"
    "relion_helix_inimodel2d"
    "relion_helix_toolbox"
    "relion_helix_vote_classes"
    "relion_image_handler"
    "relion_import"
    "relion_it.py"
    "relion_localsym"
    "relion_localsym_mpi"
    "relion_manualpick"
    "relion_mask_create"
    "relion_merge_particles"
    "relion_motion_refine"
    "relion_motion_refine_mpi"
    "relion_mrc2vtk"
    "relion_particle_reposition"
    "relion_particle_select"
    "relion_particle_subtract"
    "relion_particle_subtract_mpi"
    "relion_particle_symmetry_expand"
    "relion_pipeliner"
    "relion_plot_delocalisation"
    "relion_postprocess"
    "relion_postprocess_mpi"
    "relion_prepare_subtomo"
    "relion_preprocess"
    "relion_preprocess_mpi"
    "relion_project"
    "relion_python_blush"
    "relion_python_classranker"
    "relion_python_dynamight"
    "relion_python_fetch_weights"
    "relion_python_modelangelo"
    "relion_python_tomo_align_tilt_series"
    "relion_python_tomo_denoise"
    "relion_python_tomo_exclude_tilt_images"
    "relion_python_tomo_get_particle_poses"
    "relion_python_tomo_import"
    "relion_python_tomo_pick"
    "relion_python_tomo_view"
    "relion_python_topaz"
    "relion_qsub.csh"
    "relion_reconstruct"
    "relion_reconstruct_mpi"
    "relion_refine"
    "relion_refine_mpi"
    "relion_run_align_tiltseries"
    "relion_run_align_tiltseries_mpi"
    "relion_run_ctffind"
    "relion_run_ctffind_mpi"
    "relion_run_motioncorr"
    "relion_run_motioncorr_mpi"
    "relion_schemegui.py"
    "relion_schemer"
    "relion_stack_create"
    "relion_star_datablock_ctfdat"
    "relion_star_datablock_singlefiles"
    "relion_star_datablock_stack"
    "relion_star_handler"
    "relion_star_loopheader"
    "relion_star_plottable"
    "relion_star_printtable"
    "relion_suggest_tvalue"
    "relion_tiltpair_plot"
    "relion_tomo_add_spheres"
    "relion_tomo_align"
    "relion_tomo_align_mpi"
    "relion_tomo_bin_stack"
    "relion_tomo_catalogue_tomos"
    "relion_tomo_compute_FCC"
    "relion_tomo_convert_projections"
    "relion_tomo_dark_erase"
    "relion_tomo_delete_blobs"
    "relion_tomo_discover_motif"
    "relion_tomo_find_fiducials"
    "relion_tomo_find_lattice"
    "relion_tomo_fit_bfactors"
    "relion_tomo_fit_blobs_3d"
    "relion_tomo_import_particles"
    "relion_tomo_import_tomograms"
    "relion_tomo_local_particle_refine"
    "relion_tomo_make_optimisation_set"
    "relion_tomo_make_reference"
    "relion_tomo_powspec"
    "relion_tomo_predict_tilt_series"
    "relion_tomo_reconstruct_particle"
    "relion_tomo_reconstruct_particle_mpi"
    "relion_tomo_reconstruct_tomogram"
    "relion_tomo_reconstruct_tomogram_mpi"
    "relion_tomo_refine_ctf"
    "relion_tomo_refine_ctf_mpi"
    "relion_tomo_refine_mag"
    "relion_tomo_sample_manifold"
    "relion_tomo_split_optics"
    "relion_tomo_subtomo"
    "relion_tomo_subtomo_mpi"
    "relion_tomo_taper"
    "relion_tomo_template_pick"
    "relion_tomo_test"
    "relion_tomo_tomo_ctf"
    "relion_tomo_Wiener_divide"
    # Warp/M tools
    "EstimateWeights"
    "Frankenmap"
    "MCore"
    "MrcConverter"
    "MTools"
    "Noise2Half"
    "Noise2Map"
    "Noise2Mic"
    "Noise2Tomo"
    "WarpTools"
    "WarpWorker"
    # AreTomo2
    "AreTomo2"
)

echo "Creating wrapper symlinks..."

# Create symlinks for all tools
for tool in "${TOOLS[@]}"; do
    ln -sf "_wrapper.sh" "$SCRIPT_DIR/$tool"
    echo "  Created: $tool"
done

echo ""
echo "Done! Created ${#TOOLS[@]} wrapper symlinks."
echo ""
echo "To use the wrappers, run:"
echo "  source $SCRIPT_DIR/setup.sh /path/to/cryoem-suite.sif"
